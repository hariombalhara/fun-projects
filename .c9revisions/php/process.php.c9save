{"ts":1341845610979,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\nheader('Access-Control-Allow-Origin:*');\nheader('Content-Type:text/html');\n$uuid = $_COOKIE['identifier'];\n//echo $uuid;\n$host = $_ENV['OPENSHIFT_DB_HOST'];\n$pass = $_ENV['OPENSHIFT_DB_PASSWORD'];\n$username = $_ENV['OPENSHIFT_DB_USERNAME'];\n$port = $_ENV['OPENSHIFT_DB_PORT'];\n$conn = mysql_connect($host.\":\".$port,$username,$pass);\n$name = $_GET['name']; //TODO CHANGE TO POST\n$email = $_GET['email'];\n$score = $_GET['score'];\nif(!$conn)\n{\n    die('Error Connecting:'.mysql_error());\n}\nmysql_select_db('php',$conn);\n//echo $conn;\nif(isset($uuid)) {\n    if(!isset($score)) {\n        $query = 'Select * from `snake` where `sessionId` = \"'.$uuid.'\"';\n      //  echo $query;\n        $res = mysql_query($query) or die(mysql_error());\n        $row = mysql_fetch_array($res,MYSQL_BOTH);\n        echo \"{\n                'email':'\".$row['email'].\"',\n                'score':\".$row['highestScore'].\"\n              }\";\n        //print_r($row);\n    } else {\n        $query = 'Update `snake` set `highestScore` = '.$score.' where `sessionId` = \"'.$uuid.'\"';\n        //echo $query;\n        $res = mysql_query($query) or die(mysql_error());\n        //$row = mysql_fetch_array($res,MYSQL_BOTH);\n    }\n  \n} else {\n   global $uuid;\n   global $name;\n   global $email;\n   $uuid = uniqid();\n   $query = \"Insert into `snake` (`email`,`sessionId`,`username`) values ('\".$email.\"','\".$uuid.\"','\".$name.\"')\";\n   //echo $query;\n   $res = mysql_query($query) or die(mysql_error());\n   //echo \"Insert \".$res;\n   setcookie('identifier',$uuid);\n}\n?>"]],"start1":0,"start2":0,"length1":0,"length2":1526}]],"length":1526}
{"contributors":[],"silentsave":false,"ts":1341987415022,"patch":[[{"diffs":[[0,"COOKIE['"],[1,"uu"],[0,"id"],[-1,"entifier"],[0,"'];\n//ec"]],"start1":91,"start2":91,"length1":26,"length2":20},{"diffs":[[0,"core'];\n"],[1,"$firstget = $_GET['firstget'];\ndefine('DEFAULT_SCORE','-1');\n"],[0,"if(!$con"]],"start1":420,"start2":420,"length1":16,"length2":77},{"diffs":[[0,"(!$conn)"],[-1,"\n"],[1," "],[0,"{\n    di"]],"start1":491,"start2":491,"length1":17,"length2":17},{"diffs":[[0,"n);\n"],[-1,"//echo $conn;\nif(isset($uuid)) {"],[1,"function run_query($query, $is_get_or_set/*1 for GET and 2 for SET*/){\n    $res = mysql_query($query) or die(mysql_error());\n    $i = 0;\n    $arr = array();"],[0,"\n    if("],[-1,"!isset($score"],[1,"$is_get_or_set == 1) {\n        while($row = mysql_fetch_array($res,MYSQL_BOTH"],[0,")) {"]],"start1":574,"start2":574,"length1":61,"length2":249},{"diffs":[[0,"OTH)) {\n    "],[1,"        $arr[$i++] = $row;\n        }\n        return $arr;\n    }\n}\nfunction select_all_who_match($columnName,$value) {\n"],[0,"    $query ="]],"start1":816,"start2":816,"length1":24,"length2":142},{"diffs":[[0," where `"],[-1,"sessionId"],[1,"'.$columnName.'"],[0,"` = \"'.$"],[-1,"uuid"],[1,"value"],[0,".'\"';\n  "]],"start1":981,"start2":981,"length1":37,"length2":44},{"diffs":[[0,"    "],[-1,"  //  echo $query;\n        $res = mysql_query($query) or die(mysql_error());\n        $row = mysql_fetch_array($res,MYSQL_BOTH);\n    "],[1,"$result = run_query($query,1);\n    return $result;\n}\nfunction print_result_json($row) {\n"],[0,"    "]],"start1":1023,"start2":1023,"length1":140,"length2":96},{"diffs":[[0,"echo \"{\n"],[-1,"    "],[0,"        "]],"start1":1119,"start2":1119,"length1":20,"length2":16},{"diffs":[[0,"    "],[-1,"    's"],[1,"'highestS"],[0,"core':"],[1,"'"],[0,"\".$r"]],"start1":1176,"start2":1176,"length1":20,"length2":24},{"diffs":[[0,"core'].\""],[1,"',"],[0,"\n       "]],"start1":1212,"start2":1212,"length1":16,"length2":18},{"diffs":[[0,"    "],[-1,"  }\";\n        //print_r($row);\n    } else {\n        $query = 'Update `snake` set `highestScore` = '.$score.' where `sessionId` = \"'.$uuid.'\"';\n        //echo $query;\n        $res = mysql_query($query) or die(mysql_error());\n        //$row = mysql_fetch_array($res,MYSQL_BOTH);\n    }\n  \n} else {\n   global $uuid;\n   global $name;\n   global $email;\n"],[1,"'name':'\".$row['username'].\"',\n          }\";\n}\nif(!empty($uuid)) {\n    if($firstget == '1') {\n        $result = select_all_who_match('sessionId',$uuid);\n        print_result_json($result[0]);\n    } else {\n        if(!empty($score)) {\n            $result = select_all_who_match('sessionId',$uuid)\n            $row = $result[0];\n            if($row['highestScore'] < $score) {\n                $query = 'Update `snake` set `highestScore` = '.$score.' where `sessionId` = \"'.$uuid.'\"';\n                run_query($query,2);\n            }\n        }\n    }\n  \n} else if($firstget == '1'){\n   $result = select_all_who_match('email',$email);\n   $row = $result[0];\n   if(empty($row)) {\n    "],[0,"   $"]],"start1":1231,"start2":1231,"length1":355,"length2":687},{"diffs":[[0,"iqid();\n"],[1,"    "],[0,"   $quer"]],"start1":1927,"start2":1927,"length1":16,"length2":20},{"diffs":[[0,"\n   "],[-1,"//echo "],[1,"    run_query("],[0,"$query"],[1,",2)"],[0,";\n   "],[-1,"$res = mysql_query($query) or die(mysql_error());\n   //echo \"In"],[1,"    $row['email'] = $email;\n       $row['highestScore'] = DEFAULT_SCORE;\n       $row['username'] = $name;\n   } else {\n       $uuid = $row['sessionId'];\n   }\n   //user identified "],[0,"se"],[-1,"r"],[0,"t "],[-1,"\".$res;\n"],[1,"cookie.\n "],[0,"   s"]],"start1":2052,"start2":2052,"length1":102,"length2":227},{"diffs":[[0,"ie('"],[-1,"identifier',$uuid);\n}"],[1,"uuid',$uuid,time()+20*365*24*3600);\n    print_result_json($row);\n} else {\n    die('Unknown Handler');\n}\nsyslog(LOG_DEBUG,'************************************************************************************');"],[0,"\n?>"]],"start1":2285,"start2":2285,"length1":28,"length2":216}]],"length":2501,"saved":false}
